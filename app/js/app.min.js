// Yandex map
ymaps.ready(init);
var myMap,
    myPlacemark;

function init() {
  myMap = new ymaps.Map("map", {
    center: [59.947041, 30.385038],
    zoom: 11
  });

  var myPlacemark = new ymaps.Placemark([59.947041, 30.385038], 
    {
      hintContent: 'Ул. ыфвафывафыва, д. 212'
    },
    {
    iconLayout: 'default#image',
    iconImageHref: '../img/icons/map-marker.svg',
    iconImageSize: [57, 46],
    iconImageOffset: [-30, -42],
    hasHint: true
  });

  myPlacemark.name = 'Helllow';

  myMap.geoObjects.add(myPlacemark);
  myMap.behaviors.disable('scrollZoom');
  myMap.behaviors.disable('drag');
  myMap.controls.remove('searchControl');
  myMap.controls.remove('trafficControl');
  myMap.controls.remove('geolocationControl');
  myMap.controls.remove('typeSelector');
}

//Hamburger menu
const hamburgerMenu = document.querySelector('#hamburger-nav');
const overlay = document.querySelector('.overlay');
const close = document.querySelector('.overlay__close');


hamburgerMenu.addEventListener('click', function (event) {
  event.preventDefault();
  overlay.classList.add('overlay__show');
});

close.addEventListener('click', function (event) {
  event.preventDefault();
  overlay.classList.remove('overlay__show');
});

overlay.addEventListener('click', function (event) {
  if (event.target.className == 'overlay overlay__show') {
    overlay.classList.remove('overlay__show');
  }
});

// Acco team
const accordionName = document.querySelectorAll('.accordion__name');

accordionName.forEach(function (element) {
  element.addEventListener('click', function (event) {
    event.preventDefault();

    let accordionActive = document.querySelector('.accordion__active');
    const accordionItem = element.parentElement;
    let accordionItemClass = accordionItem.classList;
    let accordionActiveText;
    if (accordionActive == null) {
      accordionItemClass.add('accordion__active');
    }else {
      if (!accordionItemClass.contains('accordion__active')) {
        accordionActive.classList.remove('accordion__active');
        accordionItemText = accordionItem.childNodes[3];
        accordionItemText.style.transitionDelay = '.15s';
        console.log(accordionItem.style);
        accordionItemClass.add('accordion__active');
      } else {
        accordionItemClass.remove('accordion__active');
      }
    }
  })
});

// Acco menu
// const menuTitle = document.querySelectorAll('.menu__item-title');
// console.log($(window).width());

// menuTitle.forEach(function(element) {
//   element.addEventListener('click', function (event) {
//     event.preventDefault();

//     menuItem = element.parentElement.parentElement;
//     menuItemClass = menuItem.classList;

//     const menuListChild = element.parentElement.parentElement.parentElement.childNodes;
//     const menuText = menuItem.childNodes[3].childNodes[1];
//     const menuTextWrapper = menuItem.childNodes[3];
//     let menuActiveText;
//     let menuActiveTextWrapper;

//     function bigWidth() {
//       console.log('asdf')
//       if ($(window).width() < 768) {
//         menuTextWrapper.style.width = '100px';
//       }
//     }
//     function smallWidth() {
//       menuTextWrapper.style.width = '';
//     }

//     menuActive = document.querySelector('.menu__item-active');
//     if (menuActive == null) {
//       menuItemClass.add('menu__item-active');
//       bigWidth();
//       menuTextWrapper.style.transitionDelay = '0s';
//       menuText.style.transitionDelay = '.3s';
//     }else {
//       if (!menuItemClass.contains('menu__item-active')) {
//         menuActiveText = menuActive.childNodes[3].childNodes[1];
//         menuActiveTextWrapper = menuActive.childNodes[3];


//         menuActiveText.style.transitionDelay = '0s';
//         menuActiveTextWrapper.style.transitionDelay = '.2s';

//         menuActive.classList.remove('menu__item-active');
//         menuItemClass.add('menu__item-active');
//         menuTextWrapper.style.transitionDelay = '.2s';
//         menuText.style.transitionDelay = '.5s';
//       }else {
//         menuTextWrapper.style.transitionDelay = '.2s';
//         menuText.style.transitionDelay = '0s';
//         menuItemClass.remove('menu__item-active');
//       }
//     }
//   })
// });



$('.menu__item-title').on('click', function (event) {
  event.preventDefault();
  $this = $(this);

  const closeItem = $('<a>', {
    class: 'overlay__close modal__close',
    href: '#'
  });

  const activeItem = $this.closest('.menu__item');
  const menuList = $this.closest('.menu__list');
  const wasActiveItem = menuList.find('.menu__item-active');
  const $window = $(window)
  let linkWidth = parseInt($this.css('width'));
  let menuTextWrapperActive = activeItem.find('.menu__text-wrapper');

  if (activeItem.hasClass('menu__item-active')) {
    activeItem.removeClass('menu__item-active');
    menuTextWrapperActive.css('width', '0');
    menuTextWrapperActive.find('.overlay__close').remove();
    menuList.css('transform', 'translateX(0)');
  } else if (wasActiveItem.length > 0) {
    wasActiveItem.removeClass('menu__item-active');
    wasActiveItemTextWrapper = wasActiveItem.find('.menu__text-wrapper');
    activeItem.addClass('menu__item-active');
    if ($window.width() < 768 && $window.width() > 480) {
      menuTextWrapperActive.css('width', $window.width() - linkWidth * 3 + 'px')
      wasActiveItemTextWrapper.css('width', '0');
      wasActiveItemTextWrapper.find('.overlay__close').remove()
    } else if ($window.width() < 480) {
      menuTextWrapperActive.css('width', $window.width() - linkWidth + 'px');
      menuTextWrapperActive.append(closeItem);
      wasActiveItemTextWrapper.css('width', '0');
      wasActiveItemTextWrapper.find('.overlay__close').remove()
    }
  }else {
    activeItem.addClass('menu__item-active');
    if ($window.width() < 768 && $window.width() > 480) {
      menuTextWrapperActive.css('width', $window.width() - linkWidth * 3 + 'px')
    } else if ($window.width() < 480) {
      menuTextWrapperActive.css('width', $window.width() - linkWidth + 'px')
      menuTextWrapperActive.append(closeItem);
      console.log(activeItem.index());
      
      menuList.css('transform', 'translateX(' + -activeItem.index() * linkWidth + 'px');
    }
  }

  console.log(activeItem.index());
  closeItem.on('click', function (event) {
    event.preventDefault();

    activeItem.removeClass('menu__item-active');
    menuTextWrapperActive.css('width', '0');
    menuTextWrapperActive.find('.overlay__close').remove()
    menuList.css('transform', 'translateX(0)');
  })
  
});
<<<<<<< HEAD
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFlhbmRleCBtYXBcclxueW1hcHMucmVhZHkoaW5pdCk7XHJcbnZhciBteU1hcCxcclxuICBteVBsYWNlbWFyaztcclxuXHJcbmZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgbXlNYXAgPSBuZXcgeW1hcHMuTWFwKFwibWFwXCIsIHtcclxuICAgIGNlbnRlcjogWzU5Ljk0NzA0MSwgMzAuMzg1MDM4XSxcclxuICAgIHpvb206IDExXHJcbiAgfSk7XHJcblxyXG4gIHZhciBteVBsYWNlbWFyayA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoWzU5Ljk0NzA0MSwgMzAuMzg1MDM4XSwge30sIHtcclxuICAgIGljb25MYXlvdXQ6ICdkZWZhdWx0I2ltYWdlJyxcclxuICAgIGljb25JbWFnZUhyZWY6ICcuLi9pbWcvaWNvbnMvbWFwLW1hcmtlci5zdmcnLFxyXG4gICAgaWNvbkltYWdlU2l6ZTogWzU3LCA0Nl0sXHJcbiAgICBpY29uSW1hZ2VPZmZzZXQ6IFstMzAsIC00Ml1cclxuICB9KTtcclxuXHJcbiAgbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlQbGFjZW1hcmspO1xyXG4gIG15TWFwLmNvbnRyb2xzLnJlbW92ZSgnem9vbUNvbnRyb2wnKTtcclxuICBteU1hcC5jb250cm9scy5yZW1vdmUoJ3NlYXJjaENvbnRyb2wnKTtcclxuICBteU1hcC5jb250cm9scy5yZW1vdmUoJ3RyYWZmaWNDb250cm9sJyk7XHJcbiAgbXlNYXAuY29udHJvbHMucmVtb3ZlKCdnZW9sb2NhdGlvbkNvbnRyb2wnKTtcclxuICBteU1hcC5jb250cm9scy5yZW1vdmUoJ3R5cGVTZWxlY3RvcicpO1xyXG59XHJcblxyXG4vL0hhbWJ1cmdlciBtZW51XHJcbmNvbnN0IGhhbWJ1cmdlck1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjaGFtYnVyZ2VyLW5hdicpO1xyXG5jb25zdCBvdmVybGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm92ZXJsYXknKTtcclxuY29uc3QgY2xvc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3ZlcmxheV9fY2xvc2UnKTtcclxuXHJcblxyXG5oYW1idXJnZXJNZW51LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICBvdmVybGF5LmNsYXNzTGlzdC5hZGQoJ292ZXJsYXlfX3Nob3cnKTtcclxufSk7XHJcblxyXG5jbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgb3ZlcmxheS5jbGFzc0xpc3QucmVtb3ZlKCdvdmVybGF5X19zaG93Jyk7XHJcbn0pO1xyXG5cclxub3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gIGlmIChldmVudC50YXJnZXQuY2xhc3NOYW1lID09ICdvdmVybGF5IG92ZXJsYXlfX3Nob3cnKSB7XHJcbiAgICBvdmVybGF5LmNsYXNzTGlzdC5yZW1vdmUoJ292ZXJsYXlfX3Nob3cnKTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8gQWNjbyB0ZWFtXHJcbmNvbnN0IGFjY29yZGlvbk5hbWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYWNjb3JkaW9uX19uYW1lJyk7XHJcblxyXG5hY2NvcmRpb25OYW1lLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgIGxldCBhY2NvcmRpb25BY3RpdmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkaW9uX19hY3RpdmUnKTtcclxuICAgIGNvbnN0IGFjY29yZGlvbkl0ZW0gPSBlbGVtZW50LnBhcmVudEVsZW1lbnQ7XHJcbiAgICBsZXQgYWNjb3JkaW9uSXRlbUNsYXNzID0gYWNjb3JkaW9uSXRlbS5jbGFzc0xpc3Q7XHJcbiAgICBsZXQgYWNjb3JkaW9uQWN0aXZlVGV4dDtcclxuICAgIGlmIChhY2NvcmRpb25BY3RpdmUgPT0gbnVsbCkge1xyXG4gICAgICBhY2NvcmRpb25JdGVtQ2xhc3MuYWRkKCdhY2NvcmRpb25fX2FjdGl2ZScpO1xyXG4gICAgfWVsc2Uge1xyXG4gICAgICBpZiAoIWFjY29yZGlvbkl0ZW1DbGFzcy5jb250YWlucygnYWNjb3JkaW9uX19hY3RpdmUnKSkge1xyXG4gICAgICAgIGFjY29yZGlvbkFjdGl2ZS5jbGFzc0xpc3QucmVtb3ZlKCdhY2NvcmRpb25fX2FjdGl2ZScpO1xyXG4gICAgICAgIGFjY29yZGlvbkl0ZW1UZXh0ID0gYWNjb3JkaW9uSXRlbS5jaGlsZE5vZGVzWzNdO1xyXG4gICAgICAgIGFjY29yZGlvbkl0ZW1UZXh0LnN0eWxlLnRyYW5zaXRpb25EZWxheSA9ICcuMTVzJztcclxuICAgICAgICBjb25zb2xlLmxvZyhhY2NvcmRpb25JdGVtLnN0eWxlKTtcclxuICAgICAgICBhY2NvcmRpb25JdGVtQ2xhc3MuYWRkKCdhY2NvcmRpb25fX2FjdGl2ZScpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGFjY29yZGlvbkl0ZW1DbGFzcy5yZW1vdmUoJ2FjY29yZGlvbl9fYWN0aXZlJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9KVxyXG59KTtcclxuXHJcbi8vIEFjY28gbWVudVxyXG5jb25zdCBtZW51VGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubWVudV9faXRlbS10aXRsZScpO1xyXG5cclxubWVudVRpdGxlLmZvckVhY2goZnVuY3Rpb24oZWxlbWVudCkge1xyXG4gIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgbWVudUl0ZW0gPSBlbGVtZW50LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudDtcclxuICAgIG1lbnVJdGVtQ2xhc3MgPSBtZW51SXRlbS5jbGFzc0xpc3Q7XHJcblxyXG4gICAgY29uc3QgbWVudUxpc3RDaGlsZCA9IGVsZW1lbnQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2hpbGROb2RlcztcclxuICAgIGNvbnN0IG1lbnVUZXh0ID0gbWVudUl0ZW0uY2hpbGROb2Rlc1szXS5jaGlsZE5vZGVzWzFdO1xyXG4gICAgY29uc3QgbWVudVRleHRXcmFwcGVyID0gbWVudUl0ZW0uY2hpbGROb2Rlc1szXTtcclxuICAgIGxldCBtZW51QWN0aXZlVGV4dDtcclxuICAgIGxldCBtZW51QWN0aXZlVGV4dFdyYXBwZXI7XHJcblxyXG4gICAgbWVudUFjdGl2ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tZW51X19pdGVtLWFjdGl2ZScpO1xyXG4gICAgaWYgKG1lbnVBY3RpdmUgPT0gbnVsbCkge1xyXG4gICAgICBtZW51SXRlbUNsYXNzLmFkZCgnbWVudV9faXRlbS1hY3RpdmUnKTtcclxuICAgICAgbWVudVRleHRXcmFwcGVyLnN0eWxlLnRyYW5zaXRpb25EZWxheSA9ICcwcyc7XHJcbiAgICAgIG1lbnVUZXh0LnN0eWxlLnRyYW5zaXRpb25EZWxheSA9ICcuM3MnO1xyXG4gICAgfWVsc2Uge1xyXG4gICAgICBpZiAoIW1lbnVJdGVtQ2xhc3MuY29udGFpbnMoJ21lbnVfX2l0ZW0tYWN0aXZlJykpIHtcclxuICAgICAgICBtZW51QWN0aXZlVGV4dCA9IG1lbnVBY3RpdmUuY2hpbGROb2Rlc1szXS5jaGlsZE5vZGVzWzFdO1xyXG4gICAgICAgIG1lbnVBY3RpdmVUZXh0V3JhcHBlciA9IG1lbnVBY3RpdmUuY2hpbGROb2Rlc1szXTtcclxuXHJcbiAgICAgICAgbWVudUFjdGl2ZVRleHQuc3R5bGUudHJhbnNpdGlvbkRlbGF5ID0gJzBzJztcclxuICAgICAgICBtZW51QWN0aXZlVGV4dFdyYXBwZXIuc3R5bGUudHJhbnNpdGlvbkRlbGF5ID0gJy4ycyc7XHJcblxyXG4gICAgICAgIG1lbnVBY3RpdmUuY2xhc3NMaXN0LnJlbW92ZSgnbWVudV9faXRlbS1hY3RpdmUnKTtcclxuICAgICAgICBtZW51SXRlbUNsYXNzLmFkZCgnbWVudV9faXRlbS1hY3RpdmUnKTtcclxuICAgICAgICBtZW51VGV4dFdyYXBwZXIuc3R5bGUudHJhbnNpdGlvbkRlbGF5ID0gJy4ycyc7XHJcbiAgICAgICAgbWVudVRleHQuc3R5bGUudHJhbnNpdGlvbkRlbGF5ID0gJy41cyc7XHJcbiAgICAgIH1lbHNlIHtcclxuICAgICAgICBtZW51VGV4dFdyYXBwZXIuc3R5bGUudHJhbnNpdGlvbkRlbGF5ID0gJy4ycyc7XHJcbiAgICAgICAgbWVudVRleHQuc3R5bGUudHJhbnNpdGlvbkRlbGF5ID0gJzBzJztcclxuICAgICAgICBtZW51SXRlbUNsYXNzLnJlbW92ZSgnbWVudV9faXRlbS1hY3RpdmUnKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgIH1cclxuICB9KVxyXG59KTsiXX0=
=======

// Slider

function moveSlide(container, number) {
  const sliderList = container.find('.slider__list');
  const sliderItem = sliderList.children();
  let slideActive = container.find('.slider__active');

  sliderList.css('left', -number * 100 + '%');
  slideActive.removeClass('slider__active');
  sliderItem.eq(number).addClass('slider__active');
}

if (device.mobile() || device.tablet()){
  $('.slider__list').swipe({
    swipeLeft: function () {
      let $this = $(this);
      const sliderContainer = $this.closest('.slider__container');
      let nextSlide = sliderContainer.find('.slider__active').next();
      if (nextSlide.length) {
        let slideNum = nextSlide.index();
        moveSlide(sliderContainer, slideNum);
      } else {
        moveSlide(sliderContainer, 0);
      }
    },
    swipeRight: function () {
      let $this = $(this);
      const sliderContainer = $this.closest('.slider__container');
      let prevSlide = sliderContainer.find('.slider__active').prev();
      if (prevSlide.length) {
        let slideNum = prevSlide.index();
        moveSlide(sliderContainer, slideNum);
      } else {
        moveSlide(sliderContainer, sliderContainer.find('.slider__item:last-child').index());
      }
    }
  });
}

$('.arrow__link').on('click', function (event) {
  event.preventDefault();

  let $this = $(this);
  const sliderContainer = $this.closest('.slider__container');
  
  if ($this.hasClass('arrow__next')) {
    let nextSlide = sliderContainer.find('.slider__active').next();
    if (nextSlide.length) {
      let slideNum = nextSlide.index();
      moveSlide(sliderContainer, slideNum);
    } else {
      moveSlide(sliderContainer, 0);
    }
    
  }else if ($this.hasClass('arrow__prev')){
    let prevSlide = sliderContainer.find('.slider__active').prev();
    if (prevSlide.length) {
      let slideNum = prevSlide.index();
      moveSlide(sliderContainer, slideNum);
    }else {
      moveSlide(sliderContainer, sliderContainer.find('.slider__item:last-child').index());
    }
  }
});

// One page scroll
let screen = $('.screen');
const pointsWrapper = $('.points');
for (let i = 0; i < screen.length; i++) {
  const pointDot = $('<li>', {
    class: 'points__dot'
  });
  const pointLink = $('<a>', {
    class: 'points__link',
    href: '#',
    'data-index': i
  })
  if (screen.eq(i).hasClass('section__active')) {
    pointDot.addClass('points__active');
  }
  pointsWrapper.append(pointDot);
  pointDot.append(pointLink);
}

let inScroll = false;
function ops(container, index) {
  if (inScroll) return;
  inScroll = true;
  
  const sections = container.children('.screen');
  const points = pointsWrapper.children('.points__dot');
  const sectionActive = container.find('.section__active');
  const pointActive = pointsWrapper.find('.points__active');

  container.css('transform', 'translateY(' + -index * 100 + '%)');
  sectionActive.removeClass('section__active');
  pointActive.removeClass('points__active');
  
  sections.eq(index).addClass('section__active');
  points.eq(index).addClass('points__active');
  points.eq(index).css('transition-delay', '.2s');

  transitionDuration = parseFloat(container.css('transition-duration'));
  setTimeout(() => {
    inScroll = false;
  }, transitionDuration * 1000 + 100);

  points.eq(index).css('transition-delay', '0s');
}


$('.maincontant').on('wheel', function (event) {
  $this = $(this);
  const deltaY = event.originalEvent.deltaY;
  const sectionActive = $this.find('.section__active');
  let sectionIndex = deltaY > 0 ? sectionActive.next().index() : sectionActive.prev().index();
  if (sectionActive.next().length && deltaY > 0) {
    ops($this, sectionIndex);
  } else if (sectionActive.prev().length && deltaY < 0) {
    ops($this, sectionIndex);
  }
});

if (device.mobile() || device.tablet()){
  $('.maincontant').swipe({
    swipeUp: function () {
      $this = $(this);

      sectionActive = $('.maincontant').find('.section__active');
      sectionIndex = sectionActive.next().index();
      if (sectionActive.next().length) {
        ops($this, sectionIndex);
      }
    },
    swipeDown: function () {
      $this = $(this);

      sectionActive = $('.maincontant').find('.section__active');
      sectionIndex = sectionActive.prev().index();
      if (sectionActive.prev().length) {
        ops($this, sectionIndex);
      }
    }
  });
}

const findByIndex = (index) => {
  mainContent = $('.maincontant');
  dataIndex = parseInt(index.attr('data-index'));
  ops(mainContent, dataIndex);
}

$('.nav__link').on('click', function (event) {
  event.preventDefault();
  findByIndex($(this));
});

$('.overlay__link').on('click', function (event) {
  $this = $(this);
  overlayShow = $this.closest('.overlay__show');
  overlayShow.removeClass('overlay__show');
});

$('.points__link').on('click', function (event) {
  event.preventDefault();
  findByIndex($(this));
});

$('#to-order').on('click', function (event) {
  event.preventDefault();
  findByIndex($(this));
});

$('.welcome-link').on('click', function (event) {
  event.preventDefault();
  findByIndex($(this));
});

// reviews popup
function createModalRev(text, head) {
  const modalBg = $('<div>', { class: 'modal__bg' });
  const modal = $('<div>', { class: 'modal' });
  const modalText = $('<p>', { class: 'reviews__text modal__text' });
  const modalClose = $('<a>', {
    class: 'overlay__close modal__close',
    href: '#'
  });
  $('body').append(modalBg.append(modal));
  modalBg.fadeIn(500);
  modalText.text(text);
  modal.append(head);
  modal.append(modalText);
  modal.append(modalClose);

  modalBg.on('click', function (event) {
    ourTarget = event.target;
    if ($(ourTarget).hasClass('modal__bg')) {
      modalBg.fadeOut(500, () => modalBg.remove());
    }
  })
  modalClose.on('click', function (ev) {
    ev.preventDefault();
    modalBg.fadeOut(500, () => modalBg.remove());
  })
}

let reviewsText = 'Мысли все о них и о них, о них и о них. Нельзя устоять, ' +
'невозможно забыть... Никогда не думал, что булочки могут быть такими мягкими, ' +
'котлетка такой сочной, а сыр таким расплавленным. Мысли все о них и о них, о них и о ' +
'них. Нельзя устоять, невозможно забыть... Никогда не думал, что булочки могут быть ' +
'такими мягкими, котлетка такой сочной, а сыр таким расплавленным.';
$('.reviews__btn').on('click', function (event) {
  event.preventDefault();
  const $this = $(this);
  const textWrapper = $this.closest('.reviews__item-text');
  const reviewsName = textWrapper.find('.reviews__name').clone();
  
  createModalRev(reviewsText, reviewsName);
});

// Form
function createModalDelivery(text) {
  const modalBg = $('<div>', { class: 'modal__bg' });
  const modal = $('<div>', { class: 'modal msg-modal' });
  const modalText = $('<p>', { class: 'reviews__text modal__text' });
  const modalClose = $('<a>', {
    class: 'red-btn',
    href: '#'
  }).text('Закрыть');
  $('body').append(modalBg.append(modal));
  modalBg.fadeIn(500);
  modalText.text(text);
  modal.append(modalText);
  modal.append(modalClose);

  modalBg.on('click', function (event) {
    ourTarget = event.target;
    if ($(ourTarget).hasClass('modal__bg')) {
      modalBg.fadeOut(500, () => modalBg.remove());
    }
  })
  modalClose.on('click', function (ev) {
    ev.preventDefault();
    modalBg.fadeOut(500, () => modalBg.remove());
  })
}
$('.form__delivery').on('submit', submitForm);

function submitForm(event) {
  event.preventDefault();
  let form = $(event.target),
      data = form.serialize(),
      url = form.attr('action'),
      type = form.attr('method');

  ajaxForm = $.ajax({
    type: type,
    url: url,
    dataType: 'json',
    data: data
  });
  
  ajaxForm.done(function(msg) {
    createModalDelivery(msg.mes);
  });
}

// landscape
function orientationChange() {
  let focusInput = $('.form__input').is(':focus') || $('.form__textarea').is(':focus');
  if (innerHeight < 400 && !focusInput) {
    $('.orientation').css('display', 'flex');
  }else {
    $('.orientation').css('display', 'none');
  }
}

if (device.mobile()) {
  orientationChange();
  window.addEventListener("resize", function () {
    orientationChange();
  });
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gWWFuZGV4IG1hcFxyXG55bWFwcy5yZWFkeShpbml0KTtcclxudmFyIG15TWFwLFxyXG4gICAgbXlQbGFjZW1hcms7XHJcblxyXG5mdW5jdGlvbiBpbml0KCkge1xyXG4gIG15TWFwID0gbmV3IHltYXBzLk1hcChcIm1hcFwiLCB7XHJcbiAgICBjZW50ZXI6IFs1OS45NDcwNDEsIDMwLjM4NTAzOF0sXHJcbiAgICB6b29tOiAxMVxyXG4gIH0pO1xyXG5cclxuICB2YXIgbXlQbGFjZW1hcmsgPSBuZXcgeW1hcHMuUGxhY2VtYXJrKFs1OS45NDcwNDEsIDMwLjM4NTAzOF0sIFxyXG4gICAge1xyXG4gICAgICBoaW50Q29udGVudDogJ9Cj0LsuINGL0YTQstCw0YTRi9Cy0LDRhNGL0LLQsCwg0LQuIDIxMidcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICBpY29uTGF5b3V0OiAnZGVmYXVsdCNpbWFnZScsXHJcbiAgICBpY29uSW1hZ2VIcmVmOiAnLi4vaW1nL2ljb25zL21hcC1tYXJrZXIuc3ZnJyxcclxuICAgIGljb25JbWFnZVNpemU6IFs1NywgNDZdLFxyXG4gICAgaWNvbkltYWdlT2Zmc2V0OiBbLTMwLCAtNDJdLFxyXG4gICAgaGFzSGludDogdHJ1ZVxyXG4gIH0pO1xyXG5cclxuICBteVBsYWNlbWFyay5uYW1lID0gJ0hlbGxsb3cnO1xyXG5cclxuICBteU1hcC5nZW9PYmplY3RzLmFkZChteVBsYWNlbWFyayk7XHJcbiAgbXlNYXAuYmVoYXZpb3JzLmRpc2FibGUoJ3Njcm9sbFpvb20nKTtcclxuICBteU1hcC5iZWhhdmlvcnMuZGlzYWJsZSgnZHJhZycpO1xyXG4gIG15TWFwLmNvbnRyb2xzLnJlbW92ZSgnc2VhcmNoQ29udHJvbCcpO1xyXG4gIG15TWFwLmNvbnRyb2xzLnJlbW92ZSgndHJhZmZpY0NvbnRyb2wnKTtcclxuICBteU1hcC5jb250cm9scy5yZW1vdmUoJ2dlb2xvY2F0aW9uQ29udHJvbCcpO1xyXG4gIG15TWFwLmNvbnRyb2xzLnJlbW92ZSgndHlwZVNlbGVjdG9yJyk7XHJcbn1cclxuXHJcbi8vSGFtYnVyZ2VyIG1lbnUgOylcclxuY29uc3QgaGFtYnVyZ2VyTWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNoYW1idXJnZXItbmF2Jyk7XHJcbmNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3ZlcmxheScpO1xyXG5jb25zdCBjbG9zZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5vdmVybGF5X19jbG9zZScpO1xyXG5cclxuXHJcbmhhbWJ1cmdlck1lbnUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIG92ZXJsYXkuY2xhc3NMaXN0LmFkZCgnb3ZlcmxheV9fc2hvdycpO1xyXG59KTtcclxuXHJcbmNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICBvdmVybGF5LmNsYXNzTGlzdC5yZW1vdmUoJ292ZXJsYXlfX3Nob3cnKTtcclxufSk7XHJcblxyXG5vdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc05hbWUgPT0gJ292ZXJsYXkgb3ZlcmxheV9fc2hvdycpIHtcclxuICAgIG92ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZSgnb3ZlcmxheV9fc2hvdycpO1xyXG4gIH1cclxufSk7XHJcblxyXG4vLyBBY2NvIHRlYW1cclxuY29uc3QgYWNjb3JkaW9uTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hY2NvcmRpb25fX25hbWUnKTtcclxuXHJcbmFjY29yZGlvbk5hbWUuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgbGV0IGFjY29yZGlvbkFjdGl2ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRpb25fX2FjdGl2ZScpO1xyXG4gICAgY29uc3QgYWNjb3JkaW9uSXRlbSA9IGVsZW1lbnQucGFyZW50RWxlbWVudDtcclxuICAgIGxldCBhY2NvcmRpb25JdGVtQ2xhc3MgPSBhY2NvcmRpb25JdGVtLmNsYXNzTGlzdDtcclxuICAgIGxldCBhY2NvcmRpb25BY3RpdmVUZXh0O1xyXG4gICAgaWYgKGFjY29yZGlvbkFjdGl2ZSA9PSBudWxsKSB7XHJcbiAgICAgIGFjY29yZGlvbkl0ZW1DbGFzcy5hZGQoJ2FjY29yZGlvbl9fYWN0aXZlJyk7XHJcbiAgICB9ZWxzZSB7XHJcbiAgICAgIGlmICghYWNjb3JkaW9uSXRlbUNsYXNzLmNvbnRhaW5zKCdhY2NvcmRpb25fX2FjdGl2ZScpKSB7XHJcbiAgICAgICAgYWNjb3JkaW9uQWN0aXZlLmNsYXNzTGlzdC5yZW1vdmUoJ2FjY29yZGlvbl9fYWN0aXZlJyk7XHJcbiAgICAgICAgYWNjb3JkaW9uSXRlbVRleHQgPSBhY2NvcmRpb25JdGVtLmNoaWxkTm9kZXNbM107XHJcbiAgICAgICAgYWNjb3JkaW9uSXRlbVRleHQuc3R5bGUudHJhbnNpdGlvbkRlbGF5ID0gJy4xNXMnO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGFjY29yZGlvbkl0ZW0uc3R5bGUpO1xyXG4gICAgICAgIGFjY29yZGlvbkl0ZW1DbGFzcy5hZGQoJ2FjY29yZGlvbl9fYWN0aXZlJyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgYWNjb3JkaW9uSXRlbUNsYXNzLnJlbW92ZSgnYWNjb3JkaW9uX19hY3RpdmUnKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0pXHJcbn0pO1xyXG5cclxuLy8gQWNjbyBtZW51XHJcbi8vIGNvbnN0IG1lbnVUaXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tZW51X19pdGVtLXRpdGxlJyk7XHJcbi8vIGNvbnNvbGUubG9nKCQod2luZG93KS53aWR0aCgpKTtcclxuXHJcbi8vIG1lbnVUaXRsZS5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpIHtcclxuLy8gICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbi8vICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuLy8gICAgIG1lbnVJdGVtID0gZWxlbWVudC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQ7XHJcbi8vICAgICBtZW51SXRlbUNsYXNzID0gbWVudUl0ZW0uY2xhc3NMaXN0O1xyXG5cclxuLy8gICAgIGNvbnN0IG1lbnVMaXN0Q2hpbGQgPSBlbGVtZW50LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmNoaWxkTm9kZXM7XHJcbi8vICAgICBjb25zdCBtZW51VGV4dCA9IG1lbnVJdGVtLmNoaWxkTm9kZXNbM10uY2hpbGROb2Rlc1sxXTtcclxuLy8gICAgIGNvbnN0IG1lbnVUZXh0V3JhcHBlciA9IG1lbnVJdGVtLmNoaWxkTm9kZXNbM107XHJcbi8vICAgICBsZXQgbWVudUFjdGl2ZVRleHQ7XHJcbi8vICAgICBsZXQgbWVudUFjdGl2ZVRleHRXcmFwcGVyO1xyXG5cclxuLy8gICAgIGZ1bmN0aW9uIGJpZ1dpZHRoKCkge1xyXG4vLyAgICAgICBjb25zb2xlLmxvZygnYXNkZicpXHJcbi8vICAgICAgIGlmICgkKHdpbmRvdykud2lkdGgoKSA8IDc2OCkge1xyXG4vLyAgICAgICAgIG1lbnVUZXh0V3JhcHBlci5zdHlsZS53aWR0aCA9ICcxMDBweCc7XHJcbi8vICAgICAgIH1cclxuLy8gICAgIH1cclxuLy8gICAgIGZ1bmN0aW9uIHNtYWxsV2lkdGgoKSB7XHJcbi8vICAgICAgIG1lbnVUZXh0V3JhcHBlci5zdHlsZS53aWR0aCA9ICcnO1xyXG4vLyAgICAgfVxyXG5cclxuLy8gICAgIG1lbnVBY3RpdmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWVudV9faXRlbS1hY3RpdmUnKTtcclxuLy8gICAgIGlmIChtZW51QWN0aXZlID09IG51bGwpIHtcclxuLy8gICAgICAgbWVudUl0ZW1DbGFzcy5hZGQoJ21lbnVfX2l0ZW0tYWN0aXZlJyk7XHJcbi8vICAgICAgIGJpZ1dpZHRoKCk7XHJcbi8vICAgICAgIG1lbnVUZXh0V3JhcHBlci5zdHlsZS50cmFuc2l0aW9uRGVsYXkgPSAnMHMnO1xyXG4vLyAgICAgICBtZW51VGV4dC5zdHlsZS50cmFuc2l0aW9uRGVsYXkgPSAnLjNzJztcclxuLy8gICAgIH1lbHNlIHtcclxuLy8gICAgICAgaWYgKCFtZW51SXRlbUNsYXNzLmNvbnRhaW5zKCdtZW51X19pdGVtLWFjdGl2ZScpKSB7XHJcbi8vICAgICAgICAgbWVudUFjdGl2ZVRleHQgPSBtZW51QWN0aXZlLmNoaWxkTm9kZXNbM10uY2hpbGROb2Rlc1sxXTtcclxuLy8gICAgICAgICBtZW51QWN0aXZlVGV4dFdyYXBwZXIgPSBtZW51QWN0aXZlLmNoaWxkTm9kZXNbM107XHJcblxyXG5cclxuLy8gICAgICAgICBtZW51QWN0aXZlVGV4dC5zdHlsZS50cmFuc2l0aW9uRGVsYXkgPSAnMHMnO1xyXG4vLyAgICAgICAgIG1lbnVBY3RpdmVUZXh0V3JhcHBlci5zdHlsZS50cmFuc2l0aW9uRGVsYXkgPSAnLjJzJztcclxuXHJcbi8vICAgICAgICAgbWVudUFjdGl2ZS5jbGFzc0xpc3QucmVtb3ZlKCdtZW51X19pdGVtLWFjdGl2ZScpO1xyXG4vLyAgICAgICAgIG1lbnVJdGVtQ2xhc3MuYWRkKCdtZW51X19pdGVtLWFjdGl2ZScpO1xyXG4vLyAgICAgICAgIG1lbnVUZXh0V3JhcHBlci5zdHlsZS50cmFuc2l0aW9uRGVsYXkgPSAnLjJzJztcclxuLy8gICAgICAgICBtZW51VGV4dC5zdHlsZS50cmFuc2l0aW9uRGVsYXkgPSAnLjVzJztcclxuLy8gICAgICAgfWVsc2Uge1xyXG4vLyAgICAgICAgIG1lbnVUZXh0V3JhcHBlci5zdHlsZS50cmFuc2l0aW9uRGVsYXkgPSAnLjJzJztcclxuLy8gICAgICAgICBtZW51VGV4dC5zdHlsZS50cmFuc2l0aW9uRGVsYXkgPSAnMHMnO1xyXG4vLyAgICAgICAgIG1lbnVJdGVtQ2xhc3MucmVtb3ZlKCdtZW51X19pdGVtLWFjdGl2ZScpO1xyXG4vLyAgICAgICB9XHJcbi8vICAgICB9XHJcbi8vICAgfSlcclxuLy8gfSk7XHJcblxyXG5cclxuXHJcbiQoJy5tZW51X19pdGVtLXRpdGxlJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAkdGhpcyA9ICQodGhpcyk7XHJcblxyXG4gIGNvbnN0IGNsb3NlSXRlbSA9ICQoJzxhPicsIHtcclxuICAgIGNsYXNzOiAnb3ZlcmxheV9fY2xvc2UgbW9kYWxfX2Nsb3NlJyxcclxuICAgIGhyZWY6ICcjJ1xyXG4gIH0pO1xyXG5cclxuICBjb25zdCBhY3RpdmVJdGVtID0gJHRoaXMuY2xvc2VzdCgnLm1lbnVfX2l0ZW0nKTtcclxuICBjb25zdCBtZW51TGlzdCA9ICR0aGlzLmNsb3Nlc3QoJy5tZW51X19saXN0Jyk7XHJcbiAgY29uc3Qgd2FzQWN0aXZlSXRlbSA9IG1lbnVMaXN0LmZpbmQoJy5tZW51X19pdGVtLWFjdGl2ZScpO1xyXG4gIGNvbnN0ICR3aW5kb3cgPSAkKHdpbmRvdylcclxuICBsZXQgbGlua1dpZHRoID0gcGFyc2VJbnQoJHRoaXMuY3NzKCd3aWR0aCcpKTtcclxuICBsZXQgbWVudVRleHRXcmFwcGVyQWN0aXZlID0gYWN0aXZlSXRlbS5maW5kKCcubWVudV9fdGV4dC13cmFwcGVyJyk7XHJcblxyXG4gIGlmIChhY3RpdmVJdGVtLmhhc0NsYXNzKCdtZW51X19pdGVtLWFjdGl2ZScpKSB7XHJcbiAgICBhY3RpdmVJdGVtLnJlbW92ZUNsYXNzKCdtZW51X19pdGVtLWFjdGl2ZScpO1xyXG4gICAgbWVudVRleHRXcmFwcGVyQWN0aXZlLmNzcygnd2lkdGgnLCAnMCcpO1xyXG4gICAgbWVudVRleHRXcmFwcGVyQWN0aXZlLmZpbmQoJy5vdmVybGF5X19jbG9zZScpLnJlbW92ZSgpO1xyXG4gICAgbWVudUxpc3QuY3NzKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlWCgwKScpO1xyXG4gIH0gZWxzZSBpZiAod2FzQWN0aXZlSXRlbS5sZW5ndGggPiAwKSB7XHJcbiAgICB3YXNBY3RpdmVJdGVtLnJlbW92ZUNsYXNzKCdtZW51X19pdGVtLWFjdGl2ZScpO1xyXG4gICAgd2FzQWN0aXZlSXRlbVRleHRXcmFwcGVyID0gd2FzQWN0aXZlSXRlbS5maW5kKCcubWVudV9fdGV4dC13cmFwcGVyJyk7XHJcbiAgICBhY3RpdmVJdGVtLmFkZENsYXNzKCdtZW51X19pdGVtLWFjdGl2ZScpO1xyXG4gICAgaWYgKCR3aW5kb3cud2lkdGgoKSA8IDc2OCAmJiAkd2luZG93LndpZHRoKCkgPiA0ODApIHtcclxuICAgICAgbWVudVRleHRXcmFwcGVyQWN0aXZlLmNzcygnd2lkdGgnLCAkd2luZG93LndpZHRoKCkgLSBsaW5rV2lkdGggKiAzICsgJ3B4JylcclxuICAgICAgd2FzQWN0aXZlSXRlbVRleHRXcmFwcGVyLmNzcygnd2lkdGgnLCAnMCcpO1xyXG4gICAgICB3YXNBY3RpdmVJdGVtVGV4dFdyYXBwZXIuZmluZCgnLm92ZXJsYXlfX2Nsb3NlJykucmVtb3ZlKClcclxuICAgIH0gZWxzZSBpZiAoJHdpbmRvdy53aWR0aCgpIDwgNDgwKSB7XHJcbiAgICAgIG1lbnVUZXh0V3JhcHBlckFjdGl2ZS5jc3MoJ3dpZHRoJywgJHdpbmRvdy53aWR0aCgpIC0gbGlua1dpZHRoICsgJ3B4Jyk7XHJcbiAgICAgIG1lbnVUZXh0V3JhcHBlckFjdGl2ZS5hcHBlbmQoY2xvc2VJdGVtKTtcclxuICAgICAgd2FzQWN0aXZlSXRlbVRleHRXcmFwcGVyLmNzcygnd2lkdGgnLCAnMCcpO1xyXG4gICAgICB3YXNBY3RpdmVJdGVtVGV4dFdyYXBwZXIuZmluZCgnLm92ZXJsYXlfX2Nsb3NlJykucmVtb3ZlKClcclxuICAgIH1cclxuICB9ZWxzZSB7XHJcbiAgICBhY3RpdmVJdGVtLmFkZENsYXNzKCdtZW51X19pdGVtLWFjdGl2ZScpO1xyXG4gICAgaWYgKCR3aW5kb3cud2lkdGgoKSA8IDc2OCAmJiAkd2luZG93LndpZHRoKCkgPiA0ODApIHtcclxuICAgICAgbWVudVRleHRXcmFwcGVyQWN0aXZlLmNzcygnd2lkdGgnLCAkd2luZG93LndpZHRoKCkgLSBsaW5rV2lkdGggKiAzICsgJ3B4JylcclxuICAgIH0gZWxzZSBpZiAoJHdpbmRvdy53aWR0aCgpIDwgNDgwKSB7XHJcbiAgICAgIG1lbnVUZXh0V3JhcHBlckFjdGl2ZS5jc3MoJ3dpZHRoJywgJHdpbmRvdy53aWR0aCgpIC0gbGlua1dpZHRoICsgJ3B4JylcclxuICAgICAgbWVudVRleHRXcmFwcGVyQWN0aXZlLmFwcGVuZChjbG9zZUl0ZW0pO1xyXG4gICAgICBjb25zb2xlLmxvZyhhY3RpdmVJdGVtLmluZGV4KCkpO1xyXG4gICAgICBcclxuICAgICAgbWVudUxpc3QuY3NzKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlWCgnICsgLWFjdGl2ZUl0ZW0uaW5kZXgoKSAqIGxpbmtXaWR0aCArICdweCcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29uc29sZS5sb2coYWN0aXZlSXRlbS5pbmRleCgpKTtcclxuICBjbG9zZUl0ZW0ub24oJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgIGFjdGl2ZUl0ZW0ucmVtb3ZlQ2xhc3MoJ21lbnVfX2l0ZW0tYWN0aXZlJyk7XHJcbiAgICBtZW51VGV4dFdyYXBwZXJBY3RpdmUuY3NzKCd3aWR0aCcsICcwJyk7XHJcbiAgICBtZW51VGV4dFdyYXBwZXJBY3RpdmUuZmluZCgnLm92ZXJsYXlfX2Nsb3NlJykucmVtb3ZlKClcclxuICAgIG1lbnVMaXN0LmNzcygndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZVgoMCknKTtcclxuICB9KVxyXG4gIFxyXG59KTtcclxuXHJcbi8vIFNsaWRlclxyXG5cclxuZnVuY3Rpb24gbW92ZVNsaWRlKGNvbnRhaW5lciwgbnVtYmVyKSB7XHJcbiAgY29uc3Qgc2xpZGVyTGlzdCA9IGNvbnRhaW5lci5maW5kKCcuc2xpZGVyX19saXN0Jyk7XHJcbiAgY29uc3Qgc2xpZGVySXRlbSA9IHNsaWRlckxpc3QuY2hpbGRyZW4oKTtcclxuICBsZXQgc2xpZGVBY3RpdmUgPSBjb250YWluZXIuZmluZCgnLnNsaWRlcl9fYWN0aXZlJyk7XHJcblxyXG4gIHNsaWRlckxpc3QuY3NzKCdsZWZ0JywgLW51bWJlciAqIDEwMCArICclJyk7XHJcbiAgc2xpZGVBY3RpdmUucmVtb3ZlQ2xhc3MoJ3NsaWRlcl9fYWN0aXZlJyk7XHJcbiAgc2xpZGVySXRlbS5lcShudW1iZXIpLmFkZENsYXNzKCdzbGlkZXJfX2FjdGl2ZScpO1xyXG59XHJcblxyXG5pZiAoZGV2aWNlLm1vYmlsZSgpIHx8IGRldmljZS50YWJsZXQoKSl7XHJcbiAgJCgnLnNsaWRlcl9fbGlzdCcpLnN3aXBlKHtcclxuICAgIHN3aXBlTGVmdDogZnVuY3Rpb24gKCkge1xyXG4gICAgICBsZXQgJHRoaXMgPSAkKHRoaXMpO1xyXG4gICAgICBjb25zdCBzbGlkZXJDb250YWluZXIgPSAkdGhpcy5jbG9zZXN0KCcuc2xpZGVyX19jb250YWluZXInKTtcclxuICAgICAgbGV0IG5leHRTbGlkZSA9IHNsaWRlckNvbnRhaW5lci5maW5kKCcuc2xpZGVyX19hY3RpdmUnKS5uZXh0KCk7XHJcbiAgICAgIGlmIChuZXh0U2xpZGUubGVuZ3RoKSB7XHJcbiAgICAgICAgbGV0IHNsaWRlTnVtID0gbmV4dFNsaWRlLmluZGV4KCk7XHJcbiAgICAgICAgbW92ZVNsaWRlKHNsaWRlckNvbnRhaW5lciwgc2xpZGVOdW0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIG1vdmVTbGlkZShzbGlkZXJDb250YWluZXIsIDApO1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgc3dpcGVSaWdodDogZnVuY3Rpb24gKCkge1xyXG4gICAgICBsZXQgJHRoaXMgPSAkKHRoaXMpO1xyXG4gICAgICBjb25zdCBzbGlkZXJDb250YWluZXIgPSAkdGhpcy5jbG9zZXN0KCcuc2xpZGVyX19jb250YWluZXInKTtcclxuICAgICAgbGV0IHByZXZTbGlkZSA9IHNsaWRlckNvbnRhaW5lci5maW5kKCcuc2xpZGVyX19hY3RpdmUnKS5wcmV2KCk7XHJcbiAgICAgIGlmIChwcmV2U2xpZGUubGVuZ3RoKSB7XHJcbiAgICAgICAgbGV0IHNsaWRlTnVtID0gcHJldlNsaWRlLmluZGV4KCk7XHJcbiAgICAgICAgbW92ZVNsaWRlKHNsaWRlckNvbnRhaW5lciwgc2xpZGVOdW0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIG1vdmVTbGlkZShzbGlkZXJDb250YWluZXIsIHNsaWRlckNvbnRhaW5lci5maW5kKCcuc2xpZGVyX19pdGVtOmxhc3QtY2hpbGQnKS5pbmRleCgpKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4kKCcuYXJyb3dfX2xpbmsnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICBsZXQgJHRoaXMgPSAkKHRoaXMpO1xyXG4gIGNvbnN0IHNsaWRlckNvbnRhaW5lciA9ICR0aGlzLmNsb3Nlc3QoJy5zbGlkZXJfX2NvbnRhaW5lcicpO1xyXG4gIFxyXG4gIGlmICgkdGhpcy5oYXNDbGFzcygnYXJyb3dfX25leHQnKSkge1xyXG4gICAgbGV0IG5leHRTbGlkZSA9IHNsaWRlckNvbnRhaW5lci5maW5kKCcuc2xpZGVyX19hY3RpdmUnKS5uZXh0KCk7XHJcbiAgICBpZiAobmV4dFNsaWRlLmxlbmd0aCkge1xyXG4gICAgICBsZXQgc2xpZGVOdW0gPSBuZXh0U2xpZGUuaW5kZXgoKTtcclxuICAgICAgbW92ZVNsaWRlKHNsaWRlckNvbnRhaW5lciwgc2xpZGVOdW0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbW92ZVNsaWRlKHNsaWRlckNvbnRhaW5lciwgMCk7XHJcbiAgICB9XHJcbiAgICBcclxuICB9ZWxzZSBpZiAoJHRoaXMuaGFzQ2xhc3MoJ2Fycm93X19wcmV2Jykpe1xyXG4gICAgbGV0IHByZXZTbGlkZSA9IHNsaWRlckNvbnRhaW5lci5maW5kKCcuc2xpZGVyX19hY3RpdmUnKS5wcmV2KCk7XHJcbiAgICBpZiAocHJldlNsaWRlLmxlbmd0aCkge1xyXG4gICAgICBsZXQgc2xpZGVOdW0gPSBwcmV2U2xpZGUuaW5kZXgoKTtcclxuICAgICAgbW92ZVNsaWRlKHNsaWRlckNvbnRhaW5lciwgc2xpZGVOdW0pO1xyXG4gICAgfWVsc2Uge1xyXG4gICAgICBtb3ZlU2xpZGUoc2xpZGVyQ29udGFpbmVyLCBzbGlkZXJDb250YWluZXIuZmluZCgnLnNsaWRlcl9faXRlbTpsYXN0LWNoaWxkJykuaW5kZXgoKSk7XHJcbiAgICB9XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIE9uZSBwYWdlIHNjcm9sbFxyXG5sZXQgc2NyZWVuID0gJCgnLnNjcmVlbicpO1xyXG5jb25zdCBwb2ludHNXcmFwcGVyID0gJCgnLnBvaW50cycpO1xyXG5mb3IgKGxldCBpID0gMDsgaSA8IHNjcmVlbi5sZW5ndGg7IGkrKykge1xyXG4gIGNvbnN0IHBvaW50RG90ID0gJCgnPGxpPicsIHtcclxuICAgIGNsYXNzOiAncG9pbnRzX19kb3QnXHJcbiAgfSk7XHJcbiAgY29uc3QgcG9pbnRMaW5rID0gJCgnPGE+Jywge1xyXG4gICAgY2xhc3M6ICdwb2ludHNfX2xpbmsnLFxyXG4gICAgaHJlZjogJyMnLFxyXG4gICAgJ2RhdGEtaW5kZXgnOiBpXHJcbiAgfSlcclxuICBpZiAoc2NyZWVuLmVxKGkpLmhhc0NsYXNzKCdzZWN0aW9uX19hY3RpdmUnKSkge1xyXG4gICAgcG9pbnREb3QuYWRkQ2xhc3MoJ3BvaW50c19fYWN0aXZlJyk7XHJcbiAgfVxyXG4gIHBvaW50c1dyYXBwZXIuYXBwZW5kKHBvaW50RG90KTtcclxuICBwb2ludERvdC5hcHBlbmQocG9pbnRMaW5rKTtcclxufVxyXG5cclxubGV0IGluU2Nyb2xsID0gZmFsc2U7XHJcbmZ1bmN0aW9uIG9wcyhjb250YWluZXIsIGluZGV4KSB7XHJcbiAgaWYgKGluU2Nyb2xsKSByZXR1cm47XHJcbiAgaW5TY3JvbGwgPSB0cnVlO1xyXG4gIFxyXG4gIGNvbnN0IHNlY3Rpb25zID0gY29udGFpbmVyLmNoaWxkcmVuKCcuc2NyZWVuJyk7XHJcbiAgY29uc3QgcG9pbnRzID0gcG9pbnRzV3JhcHBlci5jaGlsZHJlbignLnBvaW50c19fZG90Jyk7XHJcbiAgY29uc3Qgc2VjdGlvbkFjdGl2ZSA9IGNvbnRhaW5lci5maW5kKCcuc2VjdGlvbl9fYWN0aXZlJyk7XHJcbiAgY29uc3QgcG9pbnRBY3RpdmUgPSBwb2ludHNXcmFwcGVyLmZpbmQoJy5wb2ludHNfX2FjdGl2ZScpO1xyXG5cclxuICBjb250YWluZXIuY3NzKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlWSgnICsgLWluZGV4ICogMTAwICsgJyUpJyk7XHJcbiAgc2VjdGlvbkFjdGl2ZS5yZW1vdmVDbGFzcygnc2VjdGlvbl9fYWN0aXZlJyk7XHJcbiAgcG9pbnRBY3RpdmUucmVtb3ZlQ2xhc3MoJ3BvaW50c19fYWN0aXZlJyk7XHJcbiAgXHJcbiAgc2VjdGlvbnMuZXEoaW5kZXgpLmFkZENsYXNzKCdzZWN0aW9uX19hY3RpdmUnKTtcclxuICBwb2ludHMuZXEoaW5kZXgpLmFkZENsYXNzKCdwb2ludHNfX2FjdGl2ZScpO1xyXG4gIHBvaW50cy5lcShpbmRleCkuY3NzKCd0cmFuc2l0aW9uLWRlbGF5JywgJy4ycycpO1xyXG5cclxuICB0cmFuc2l0aW9uRHVyYXRpb24gPSBwYXJzZUZsb2F0KGNvbnRhaW5lci5jc3MoJ3RyYW5zaXRpb24tZHVyYXRpb24nKSk7XHJcbiAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICBpblNjcm9sbCA9IGZhbHNlO1xyXG4gIH0sIHRyYW5zaXRpb25EdXJhdGlvbiAqIDEwMDAgKyAxMDApO1xyXG5cclxuICBwb2ludHMuZXEoaW5kZXgpLmNzcygndHJhbnNpdGlvbi1kZWxheScsICcwcycpO1xyXG59XHJcblxyXG5cclxuJCgnLm1haW5jb250YW50Jykub24oJ3doZWVsJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgJHRoaXMgPSAkKHRoaXMpO1xyXG4gIGNvbnN0IGRlbHRhWSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQuZGVsdGFZO1xyXG4gIGNvbnN0IHNlY3Rpb25BY3RpdmUgPSAkdGhpcy5maW5kKCcuc2VjdGlvbl9fYWN0aXZlJyk7XHJcbiAgbGV0IHNlY3Rpb25JbmRleCA9IGRlbHRhWSA+IDAgPyBzZWN0aW9uQWN0aXZlLm5leHQoKS5pbmRleCgpIDogc2VjdGlvbkFjdGl2ZS5wcmV2KCkuaW5kZXgoKTtcclxuICBpZiAoc2VjdGlvbkFjdGl2ZS5uZXh0KCkubGVuZ3RoICYmIGRlbHRhWSA+IDApIHtcclxuICAgIG9wcygkdGhpcywgc2VjdGlvbkluZGV4KTtcclxuICB9IGVsc2UgaWYgKHNlY3Rpb25BY3RpdmUucHJldigpLmxlbmd0aCAmJiBkZWx0YVkgPCAwKSB7XHJcbiAgICBvcHMoJHRoaXMsIHNlY3Rpb25JbmRleCk7XHJcbiAgfVxyXG59KTtcclxuXHJcbmlmIChkZXZpY2UubW9iaWxlKCkgfHwgZGV2aWNlLnRhYmxldCgpKXtcclxuICAkKCcubWFpbmNvbnRhbnQnKS5zd2lwZSh7XHJcbiAgICBzd2lwZVVwOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICR0aGlzID0gJCh0aGlzKTtcclxuXHJcbiAgICAgIHNlY3Rpb25BY3RpdmUgPSAkKCcubWFpbmNvbnRhbnQnKS5maW5kKCcuc2VjdGlvbl9fYWN0aXZlJyk7XHJcbiAgICAgIHNlY3Rpb25JbmRleCA9IHNlY3Rpb25BY3RpdmUubmV4dCgpLmluZGV4KCk7XHJcbiAgICAgIGlmIChzZWN0aW9uQWN0aXZlLm5leHQoKS5sZW5ndGgpIHtcclxuICAgICAgICBvcHMoJHRoaXMsIHNlY3Rpb25JbmRleCk7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBzd2lwZURvd246IGZ1bmN0aW9uICgpIHtcclxuICAgICAgJHRoaXMgPSAkKHRoaXMpO1xyXG5cclxuICAgICAgc2VjdGlvbkFjdGl2ZSA9ICQoJy5tYWluY29udGFudCcpLmZpbmQoJy5zZWN0aW9uX19hY3RpdmUnKTtcclxuICAgICAgc2VjdGlvbkluZGV4ID0gc2VjdGlvbkFjdGl2ZS5wcmV2KCkuaW5kZXgoKTtcclxuICAgICAgaWYgKHNlY3Rpb25BY3RpdmUucHJldigpLmxlbmd0aCkge1xyXG4gICAgICAgIG9wcygkdGhpcywgc2VjdGlvbkluZGV4KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG5jb25zdCBmaW5kQnlJbmRleCA9IChpbmRleCkgPT4ge1xyXG4gIG1haW5Db250ZW50ID0gJCgnLm1haW5jb250YW50Jyk7XHJcbiAgZGF0YUluZGV4ID0gcGFyc2VJbnQoaW5kZXguYXR0cignZGF0YS1pbmRleCcpKTtcclxuICBvcHMobWFpbkNvbnRlbnQsIGRhdGFJbmRleCk7XHJcbn1cclxuXHJcbiQoJy5uYXZfX2xpbmsnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGZpbmRCeUluZGV4KCQodGhpcykpO1xyXG59KTtcclxuXHJcbiQoJy5vdmVybGF5X19saW5rJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgJHRoaXMgPSAkKHRoaXMpO1xyXG4gIG92ZXJsYXlTaG93ID0gJHRoaXMuY2xvc2VzdCgnLm92ZXJsYXlfX3Nob3cnKTtcclxuICBvdmVybGF5U2hvdy5yZW1vdmVDbGFzcygnb3ZlcmxheV9fc2hvdycpO1xyXG59KTtcclxuXHJcbiQoJy5wb2ludHNfX2xpbmsnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGZpbmRCeUluZGV4KCQodGhpcykpO1xyXG59KTtcclxuXHJcbiQoJyN0by1vcmRlcicpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgZmluZEJ5SW5kZXgoJCh0aGlzKSk7XHJcbn0pO1xyXG5cclxuJCgnLndlbGNvbWUtbGluaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgZmluZEJ5SW5kZXgoJCh0aGlzKSk7XHJcbn0pO1xyXG5cclxuLy8gcmV2aWV3cyBwb3B1cFxyXG5mdW5jdGlvbiBjcmVhdGVNb2RhbFJldih0ZXh0LCBoZWFkKSB7XHJcbiAgY29uc3QgbW9kYWxCZyA9ICQoJzxkaXY+JywgeyBjbGFzczogJ21vZGFsX19iZycgfSk7XHJcbiAgY29uc3QgbW9kYWwgPSAkKCc8ZGl2PicsIHsgY2xhc3M6ICdtb2RhbCcgfSk7XHJcbiAgY29uc3QgbW9kYWxUZXh0ID0gJCgnPHA+JywgeyBjbGFzczogJ3Jldmlld3NfX3RleHQgbW9kYWxfX3RleHQnIH0pO1xyXG4gIGNvbnN0IG1vZGFsQ2xvc2UgPSAkKCc8YT4nLCB7XHJcbiAgICBjbGFzczogJ292ZXJsYXlfX2Nsb3NlIG1vZGFsX19jbG9zZScsXHJcbiAgICBocmVmOiAnIydcclxuICB9KTtcclxuICAkKCdib2R5JykuYXBwZW5kKG1vZGFsQmcuYXBwZW5kKG1vZGFsKSk7XHJcbiAgbW9kYWxCZy5mYWRlSW4oNTAwKTtcclxuICBtb2RhbFRleHQudGV4dCh0ZXh0KTtcclxuICBtb2RhbC5hcHBlbmQoaGVhZCk7XHJcbiAgbW9kYWwuYXBwZW5kKG1vZGFsVGV4dCk7XHJcbiAgbW9kYWwuYXBwZW5kKG1vZGFsQ2xvc2UpO1xyXG5cclxuICBtb2RhbEJnLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgb3VyVGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xyXG4gICAgaWYgKCQob3VyVGFyZ2V0KS5oYXNDbGFzcygnbW9kYWxfX2JnJykpIHtcclxuICAgICAgbW9kYWxCZy5mYWRlT3V0KDUwMCwgKCkgPT4gbW9kYWxCZy5yZW1vdmUoKSk7XHJcbiAgICB9XHJcbiAgfSlcclxuICBtb2RhbENsb3NlLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldikge1xyXG4gICAgZXYucHJldmVudERlZmF1bHQoKTtcclxuICAgIG1vZGFsQmcuZmFkZU91dCg1MDAsICgpID0+IG1vZGFsQmcucmVtb3ZlKCkpO1xyXG4gIH0pXHJcbn1cclxuXHJcbmxldCByZXZpZXdzVGV4dCA9ICfQnNGL0YHQu9C4INCy0YHQtSDQviDQvdC40YUg0Lgg0L4g0L3QuNGFLCDQviDQvdC40YUg0Lgg0L4g0L3QuNGFLiDQndC10LvRjNC30Y8g0YPRgdGC0L7Rj9GC0YwsICcgK1xyXG4n0L3QtdCy0L7Qt9C80L7QttC90L4g0LfQsNCx0YvRgtGMLi4uINCd0LjQutC+0LPQtNCwINC90LUg0LTRg9C80LDQuywg0YfRgtC+INCx0YPQu9C+0YfQutC4INC80L7Qs9GD0YIg0LHRi9GC0Ywg0YLQsNC60LjQvNC4INC80Y/Qs9C60LjQvNC4LCAnICtcclxuJ9C60L7RgtC70LXRgtC60LAg0YLQsNC60L7QuSDRgdC+0YfQvdC+0LksINCwINGB0YvRgCDRgtCw0LrQuNC8INGA0LDRgdC/0LvQsNCy0LvQtdC90L3Ri9C8LiDQnNGL0YHQu9C4INCy0YHQtSDQviDQvdC40YUg0Lgg0L4g0L3QuNGFLCDQviDQvdC40YUg0Lgg0L4gJyArXHJcbifQvdC40YUuINCd0LXQu9GM0LfRjyDRg9GB0YLQvtGP0YLRjCwg0L3QtdCy0L7Qt9C80L7QttC90L4g0LfQsNCx0YvRgtGMLi4uINCd0LjQutC+0LPQtNCwINC90LUg0LTRg9C80LDQuywg0YfRgtC+INCx0YPQu9C+0YfQutC4INC80L7Qs9GD0YIg0LHRi9GC0YwgJyArXHJcbifRgtCw0LrQuNC80Lgg0LzRj9Cz0LrQuNC80LgsINC60L7RgtC70LXRgtC60LAg0YLQsNC60L7QuSDRgdC+0YfQvdC+0LksINCwINGB0YvRgCDRgtCw0LrQuNC8INGA0LDRgdC/0LvQsNCy0LvQtdC90L3Ri9C8Lic7XHJcbiQoJy5yZXZpZXdzX19idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGNvbnN0ICR0aGlzID0gJCh0aGlzKTtcclxuICBjb25zdCB0ZXh0V3JhcHBlciA9ICR0aGlzLmNsb3Nlc3QoJy5yZXZpZXdzX19pdGVtLXRleHQnKTtcclxuICBjb25zdCByZXZpZXdzTmFtZSA9IHRleHRXcmFwcGVyLmZpbmQoJy5yZXZpZXdzX19uYW1lJykuY2xvbmUoKTtcclxuICBcclxuICBjcmVhdGVNb2RhbFJldihyZXZpZXdzVGV4dCwgcmV2aWV3c05hbWUpO1xyXG59KTtcclxuXHJcbi8vIEZvcm1cclxuZnVuY3Rpb24gY3JlYXRlTW9kYWxEZWxpdmVyeSh0ZXh0KSB7XHJcbiAgY29uc3QgbW9kYWxCZyA9ICQoJzxkaXY+JywgeyBjbGFzczogJ21vZGFsX19iZycgfSk7XHJcbiAgY29uc3QgbW9kYWwgPSAkKCc8ZGl2PicsIHsgY2xhc3M6ICdtb2RhbCBtc2ctbW9kYWwnIH0pO1xyXG4gIGNvbnN0IG1vZGFsVGV4dCA9ICQoJzxwPicsIHsgY2xhc3M6ICdyZXZpZXdzX190ZXh0IG1vZGFsX190ZXh0JyB9KTtcclxuICBjb25zdCBtb2RhbENsb3NlID0gJCgnPGE+Jywge1xyXG4gICAgY2xhc3M6ICdyZWQtYnRuJyxcclxuICAgIGhyZWY6ICcjJ1xyXG4gIH0pLnRleHQoJ9CX0LDQutGA0YvRgtGMJyk7XHJcbiAgJCgnYm9keScpLmFwcGVuZChtb2RhbEJnLmFwcGVuZChtb2RhbCkpO1xyXG4gIG1vZGFsQmcuZmFkZUluKDUwMCk7XHJcbiAgbW9kYWxUZXh0LnRleHQodGV4dCk7XHJcbiAgbW9kYWwuYXBwZW5kKG1vZGFsVGV4dCk7XHJcbiAgbW9kYWwuYXBwZW5kKG1vZGFsQ2xvc2UpO1xyXG5cclxuICBtb2RhbEJnLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgb3VyVGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xyXG4gICAgaWYgKCQob3VyVGFyZ2V0KS5oYXNDbGFzcygnbW9kYWxfX2JnJykpIHtcclxuICAgICAgbW9kYWxCZy5mYWRlT3V0KDUwMCwgKCkgPT4gbW9kYWxCZy5yZW1vdmUoKSk7XHJcbiAgICB9XHJcbiAgfSlcclxuICBtb2RhbENsb3NlLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldikge1xyXG4gICAgZXYucHJldmVudERlZmF1bHQoKTtcclxuICAgIG1vZGFsQmcuZmFkZU91dCg1MDAsICgpID0+IG1vZGFsQmcucmVtb3ZlKCkpO1xyXG4gIH0pXHJcbn1cclxuJCgnLmZvcm1fX2RlbGl2ZXJ5Jykub24oJ3N1Ym1pdCcsIHN1Ym1pdEZvcm0pO1xyXG5cclxuZnVuY3Rpb24gc3VibWl0Rm9ybShldmVudCkge1xyXG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgbGV0IGZvcm0gPSAkKGV2ZW50LnRhcmdldCksXHJcbiAgICAgIGRhdGEgPSBmb3JtLnNlcmlhbGl6ZSgpLFxyXG4gICAgICB1cmwgPSBmb3JtLmF0dHIoJ2FjdGlvbicpLFxyXG4gICAgICB0eXBlID0gZm9ybS5hdHRyKCdtZXRob2QnKTtcclxuXHJcbiAgYWpheEZvcm0gPSAkLmFqYXgoe1xyXG4gICAgdHlwZTogdHlwZSxcclxuICAgIHVybDogdXJsLFxyXG4gICAgZGF0YVR5cGU6ICdqc29uJyxcclxuICAgIGRhdGE6IGRhdGFcclxuICB9KTtcclxuICBcclxuICBhamF4Rm9ybS5kb25lKGZ1bmN0aW9uKG1zZykge1xyXG4gICAgY3JlYXRlTW9kYWxEZWxpdmVyeShtc2cubWVzKTtcclxuICB9KTtcclxufVxyXG5cclxuLy8gbGFuZHNjYXBlXHJcbmZ1bmN0aW9uIG9yaWVudGF0aW9uQ2hhbmdlKCkge1xyXG4gIGxldCBmb2N1c0lucHV0ID0gJCgnLmZvcm1fX2lucHV0JykuaXMoJzpmb2N1cycpIHx8ICQoJy5mb3JtX190ZXh0YXJlYScpLmlzKCc6Zm9jdXMnKTtcclxuICBpZiAoaW5uZXJIZWlnaHQgPCA0MDAgJiYgIWZvY3VzSW5wdXQpIHtcclxuICAgICQoJy5vcmllbnRhdGlvbicpLmNzcygnZGlzcGxheScsICdmbGV4Jyk7XHJcbiAgfWVsc2Uge1xyXG4gICAgJCgnLm9yaWVudGF0aW9uJykuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcclxuICB9XHJcbn1cclxuXHJcbmlmIChkZXZpY2UubW9iaWxlKCkpIHtcclxuICBvcmllbnRhdGlvbkNoYW5nZSgpO1xyXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgIG9yaWVudGF0aW9uQ2hhbmdlKCk7XHJcbiAgfSk7XHJcbn1cclxuIl19
>>>>>>> a059d7c538aedfb47e1f656f62e14794581a6349
